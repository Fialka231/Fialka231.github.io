<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Přihláška na školení ECOVIS</title>
  <style>
    :root { --ecovis-red:#b5121b; --ecovis-white:#ffffff; --muted:#666; --ink:#222; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--ecovis-white); color:var(--ink); margin:0; }
    header { background:var(--ecovis-red); color:white; padding:16px; display:flex; align-items:center; gap:14px; }
    header img { width:64px; height:64px; border-radius:50%; background:white; }
    header h1 { font-size:1.8rem; margin:0; }
    .wrap { max-width:900px; margin:24px auto; padding:0 16px; }
    form { background:#fff; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,.08); padding:24px; }
    fieldset { border:1px solid #e5e5e5; border-radius:10px; padding:16px; margin-bottom:20px; }
    legend { padding:0 6px; font-weight:600; color:var(--ecovis-red); }
    label { display:block; margin-top:8px; font-weight:500; }
    input, textarea, select { width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; font-size:1rem; box-sizing:border-box; }
    textarea { min-height:100px; resize:vertical; }
    button { background:var(--ecovis-red); color:white; border:0; border-radius:8px; padding:12px 16px; font-size:1rem; cursor:pointer; }
    button:hover { opacity:0.9; }

    .checkline { display:flex; align-items:flex-start; gap:10px; padding:10px 12px; border:1px solid #ddd; border-radius:10px; background:#fff; margin-top:10px; cursor:pointer; }
    .checkline:hover { border-color: var(--ecovis-red); }
    .checkline input[type="checkbox"] { width:22px; height:22px; flex:0 0 22px; margin-top:3px; accent-color: var(--ecovis-red); }
    .checkline span { line-height:1.35; font-weight:500; }
    .checkline .hint { display:block; font-weight:400; color:var(--muted); margin-top:2px; }

    #attendees { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:12px; margin-top:12px; }
    .attendee-box { background:#f9f9f9; border:1px solid #ddd; border-radius:8px; padding:12px; display:flex; flex-direction:column; }
    .attendee-box label { margin:0 0 4px 0; font-weight:500; font-size:0.95rem; }

    .hint { font-size:.9rem; color:var(--muted); }
    .ok { color:green; }
    .err { color:#c62828; }

    #qrcode { display:none; margin-top:10px; }
    #qrcode img { max-width:150px; border:1px solid #ddd; padding:4px; }
  </style>
</head>
<body>
  <header>
    <img src="https://media.licdn.com/dms/image/v2/C4D0BAQEDUpY9Cfe5eg/company-logo_200_200/company-logo_200_200/0/1630518714792?e=2147483647&v=beta&t=-TTxTAKDyCQjMkaX8U-rIVESsqVSJxchJpp_IxWvoTY" alt="ECOVIS logo">
    <h1>Přihláška na školení ECOVIS</h1>
  </header>

  <div class="wrap">
    <form id="regForm">
      <fieldset>
        <legend>Firma a kontakt</legend>
        <label>Název společnosti*</label>
        <input type="text" id="company" required placeholder="ECOVIS FACTA a.s.">
        <label>IČO společnosti*</label>
        <input type="text" id="ico" required placeholder="12345678">
        <label>Kontaktní e-mail*</label>
        <input type="email" id="email" required placeholder="jana.novakova@firma.cz">
        <label>Telefon*</label>
        <input type="tel" id="phone" required placeholder="+420 777 000 000">
      </fieldset>

      <fieldset>
        <legend>Výběr přednášek</legend>
        <label class="checkline">
          <input type="checkbox" name="lectures" value="A">
          <span><strong>Přednáška A – Daňové novinky 2025</strong><br><span class="hint">cena 1200 Kč / osoba</span></span>
        </label>
        <label class="checkline">
          <input type="checkbox" name="lectures" value="B">
          <span><strong>Přednáška B – Digitalizace účetnictví</strong><br><span class="hint">cena 900 Kč / osoba</span></span>
        </label>
        <label class="checkline">
          <input type="checkbox" name="lectures" value="C">
          <span><strong>Přednáška C – Personalistika v praxi</strong><br><span class="hint">cena 800 Kč / osoba</span></span>
        </label>
      </fieldset>

      <fieldset>
        <legend>Účastníci</legend>
        <label>Počet účastníků*</label>
        <input type="number" id="qty" min="1" value="1" required>
        <div id="attendees"></div>
      </fieldset>

      <fieldset>
        <legend>Další požadavky</legend>
        <label>Komentáře a požadavky</label>
        <textarea id="comments"></textarea>
        <label class="checkline"><input type="checkbox" id="gdpr" required><span>Souhlasím se zpracováním osobních údajů<span class="hint"> pro účely registrace a fakturace</span></span></label>
      </fieldset>

      <p><strong>Celkem k úhradě:</strong> <span id="total">0 Kč</span></p>

      <div id="qrcode"></div>
      <p id="qrHint" class="hint" style="display:none;">QR kód byl úspěšně vygenerován pro platbu přes Raiffeisenbank.</p>

      <button type="submit">Odeslat přihlášku</button>
      <p id="msg" class="hint"></p>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    emailjs.init('FZNVPdu8YkKVsmazN');

    const prices = {A:1200,B:900,C:800};
    const qtyInput = document.getElementById('qty');
    const attendeesDiv = document.getElementById('attendees');
    const qrDiv = document.getElementById('qrcode');
    const qrHint = document.getElementById('qrHint');

    function updateAttendeeBoxes(){
      const count = parseInt(qtyInput.value||'0',10);
      attendeesDiv.innerHTML='';
      for(let i=1;i<=count;i++){
        const box=document.createElement('div');
        box.className='attendee-box';
        box.innerHTML=`<label>Účastník ${i} – jméno</label><input type='text' name='attendee${i}' placeholder='Jméno účastníka ${i}' required>`;
        attendeesDiv.appendChild(box);
      }
    }

    function calcTotal(){
      const qty = parseInt(document.getElementById('qty').value||'0',10);
      const lectures = Array.from(document.querySelectorAll('input[name="lectures"]:checked')).map(x=>x.value);
      let sum=0; lectures.forEach(l=>sum+=prices[l]||0);
      document.getElementById('total').textContent=(sum*qty).toLocaleString('cs-CZ')+' Kč';
      return {total:sum*qty, lectures, qty};
    }

    function buildQrPayload(amount, vs, msg){
      const iban = "CZ7355000000005377695001";
      const currency = "CZK";
      return `SPD*1.0*ACC:${iban}*AM:${amount.toFixed(2)}*CC:${currency}*X-VS:${vs}*MSG:${encodeURIComponent(msg)}`;
    }

    function generateQr(amount, vs, msg){
      const payload = buildQrPayload(amount, vs, msg);
      const url = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${payload}`;
      qrDiv.innerHTML = `<img src='${url}' alt='QR Platba'>`;
      return url;
    }

    qtyInput.addEventListener('input',()=>{updateAttendeeBoxes();calcTotal();});
    document.querySelectorAll('input[name="lectures"]').forEach(cb=>cb.addEventListener('change',calcTotal));
    updateAttendeeBoxes();

    document.getElementById('regForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const {total, lectures, qty}=calcTotal();
      const company=document.getElementById('company').value;
      const ico=document.getElementById('ico').value;
      const email=document.getElementById('email').value;
      const phone=document.getElementById('phone').value;
      const comments=document.getElementById('comments').value||'-';
      const msgText=`Školení ECOVIS – ${lectures.join(', ')} – ${company}`;
      const qrUrl=generateQr(total, ico, msgText);

      // Collect all attendee names
      const attendeeInputs = attendeesDiv.querySelectorAll('input[name^="attendee"]');
      const attendeeNames = Array.from(attendeeInputs)
        .map((a,i) => `Účastník ${i+1}: ${a.value || '-'}`)
        .join('\\n');

      const data={
        company,
        email,
        phone,
        event_date:'',
        lectures:lectures.join(', '),
        attendees:String(qty),
        attendee_names:attendeeNames,
        comments,
        amount:total+' Kč',
        vs:ico,
        qr_image_base64:qrUrl
      };

      try {
        await emailjs.send('service_2udpiju','template_zyyq9yf',{
          ...data,
          reply_to:email,
          cc_email:'frantisek.fiala@ecovis.cz'
        });
        document.getElementById('msg').textContent='Přihláška odeslána. Potvrzení bylo zasláno na '+email;
        document.getElementById('msg').className='ok';
        qrDiv.style.display='block';
        qrHint.style.display='block';
      } catch(err){
        console.error(err);
        document.getElementById('msg').textContent='Chyba při odesílání e-mailu.';
        document.getElementById('msg').className='err';
      }
    });
  </script>
</body>
</html>
